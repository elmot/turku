<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Turku SightSeeings</title>
    <link type="text/css" rel="stylesheet" href="css/loading.css"/>
    <link type="text/css" rel="stylesheet" href="css/renderers.css"/>
    <link type="text/css" rel="stylesheet" href="fonts/Vaadin-Icons.css"/>
    <link type="text/css" rel="stylesheet" href="fonts/map-icons.min.css"/>
    <!-- Import Web Component polyfills from CDN -->
    <script src='https://cdn.vaadin.com/vaadin-components/latest/webcomponentsjs/webcomponents-lite.js'></script>
    <link href='https://cdn.vaadin.com/vaadin-components/latest/vaadin-grid/vaadin-grid.html' rel='import'>


    <script onerror="alert(this)">

        var rendererUtils = {
            vaadinTypeIcon: function (charCode, tooltip, additionalClasses) {
                if (additionalClasses == null)  additionalClasses = "";
                return '<span class="vaadin-icon icon ' + additionalClasses + '" title="' + tooltip + '">&#x' + charCode + ';</span>';
            },
            mapTypeIcon: function (mapClass, tooltip, additionalClasses) {
                if (additionalClasses == null)  additionalClasses = "";
                return '<span class="icon map-icon ' + mapClass + ' ' + additionalClasses + '" title="' + tooltip + '"></span>';
            },
            renderTransport: function (transport) {
                if (transport == null) return "";
                transport = transport.toUpperCase().split(",");
                var html = "";
                for (var j = 0; j < transport.length; j++) {
                    if (j > 0) html += " , ";
                    var k = transport[j];
                    var trHtml = "";
                    for (var i = k.length - 1; i >= 0; i--) {
                        switch (k.charAt(i)) {
                            case ' ':
                                break;
                            case 'L':
                                trHtml = '<span class="transport-long">' + trHtml + '</span>';
                                break;
                            case 'W':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-walking", "Walk");
                                break;
                            case 'C':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-taxi-stand", "Car");
                                break;
                            case 'B':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-bicycling", "Bike");
                                break;
                            case 'S':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-boat-tour", "Ship");
                                break;
                            case 'Y':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-sailing", "Yacht");
                                break;
                            case 'F':
                                trHtml += rendererUtils.mapTypeIcon("map-icon-boat-tour", "Ferry");
                                break;
                        }
                    }
                    html += trHtml;
                }
                return html;
            }
        };
        function initSpreadSheet(gridQuerySelector, worksheetId, sheetId) {
            var sheetUrl = "https://spreadsheets.google.com//feeds/cells/" + worksheetId + "/" + sheetId
                    + "/public/basic?alt=json-in-script";

            return function () {
                document.body.className = "wait loading-data";
                var script = document.createElement("script");
                script.onerror = function (event) {
                    document.body.className = "error"
                };
                document.head.appendChild(script);
                gdata = {
                    io: {
                        handleScriptLoaded: function (json) {
                            var arrayData = gdata.data = [];
                            for (var cellIdx = 0; cellIdx < json.feed.entry.length; cellIdx++) {
                                var cell = json.feed.entry[cellIdx];
                                var coords = /\/R(\d+)C(\d+)$/.exec(cell.id.$t);
                                var row = parseInt(coords[1]) - 1;
                                var column = parseInt(coords[2]) - 1;
                                if (arrayData[row] == null) arrayData[row] = [];
                                arrayData[row][column] = cell.content.$t
                            }
                            var data = [];
                            for (var i = 1; i < arrayData.length; i++) {
                                var oldRow = arrayData[i];
                                var newRow = {};
                                for (var j = 0; j < oldRow.length; j++)
                                    newRow[arrayData[0][j]] = arrayData[i][j];
                                data.push(newRow)
                            }
                            grid = document.querySelector(gridQuerySelector);
                            grid.columns[0].renderer = function (cell) {
                                var cellText = cell.data;
                                var url = cell.row.data.URLs;
                                if (url != null && url.trim() != "")
                                    cellText = "<a target='userurl' href='" + url + "'>" + cellText + "</a>"

                                var type = cell.row.data.Type.trim();
                                switch (type.toLowerCase()) {
                                    case "":
                                    case "null":
                                        break;

                                    case "activity park":
                                    case "adventure park":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-archery", type);
                                        break;
                                    case "castle":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-city-hall", type);
                                        break;
                                    case "church":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-church", type);
                                        break;
                                    case "museum":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-museum", type);
                                        break;
                                    case "nature":
                                    case "nature park":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-climbing", type);
                                        break;
                                    case "spa":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-spa", type);
                                        break;
                                    case "ship cruise":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-boat-tour", type);
                                        break;
                                    case "trail":
                                    case "trails":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-trail-walking", type);
                                        break;
                                    case "trip":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-route", type);
                                        break;
                                    case "water park":
                                        cellText += rendererUtils.mapTypeIcon("map-icon-swimming", type);
                                        break;
                                    default:
                                        cellText += "(" + type + ")"
                                }
                                cell.element.innerHTML = cellText


                            };
                            grid.columns[1].renderer = function (cell) {
                                var cellText = cell.data;
                                var url = cell.row.data.Map
                                if (url != null && url.trim() != "")
                                    cellText = "<a target='userMap' href='" + url + "'>" + cellText + "</a>"
                                cell.element.innerHTML = cellText
                            };
                            grid.columns[3].renderer = function (cell) {
                                var cellText = cell.data;
                                var season = cell.row.data.Season;
                                if (season != null)
                                    cellText += "/" + season;
                                cell.element.innerHTML = cellText
                            };
                            grid.columns[4].renderer = function (cell) {
                                var cellText = cell.data;
                                var dist = cell.row.data.Distance;
                                if (dist != "0" && !isNaN(parseInt(dist)))
                                    cellText += " (" + dist + "km)";
                                cell.element.innerHTML = cellText
                            };
                            grid.columns[5].renderer = function (cell) {
                                var fee = cell.data.toUpperCase();
                                var html = "";
                                switch (fee) {
                                    case "P":
                                        html = rendererUtils.vaadinTypeIcon("e60a", "Paid", "money");
                                        break;
                                    case "O":
                                        html = rendererUtils.vaadinTypeIcon("e77e", "Paid Online", "money");
                                        break;
                                }
                                html+= rendererUtils.renderTransport(cell.row.data.Transport);
                                cell.element.innerHTML = html;
                            };

                            grid.items = data;
                            document.body.className = ""
                        }
                    }

                };
                script.src = sheetUrl
            }
        }


        HTMLImports.whenReady(initSpreadSheet("vaadin-grid", "1JweHWyLI30MkZiGh1xpzDPynE9zehxQ3tuhZukCFzZE", "od6"))
    </script>

</head>

<body class="wait loading-elements">
<vaadin-grid selection-mode="multi">
    <table>
        <!-- Define the columns -->
        <col name="Name" header-text="Name" sort="true">
        <col name="Description" header-text="Description & Map">
        <col name="Kid_Rate" header-text="Kid rate">
        <col name="Open" header-text="Open">
        <col name="Duration" header-text="Expected duration(Distance)">
        <col name="Fee" header-text="Getting there">
    </table>
</vaadin-grid>
</body>
</html>